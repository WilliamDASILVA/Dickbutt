var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Camera=function(t){function e(e){t.call(this),this.parentScene=e,this.position=new Point(0,0),this.depth=1,this.depthPosition=new Point(0,0),this.rotationPoint=new Point(0,0),this.angle=0,this.isCameraLock=!1,this.cameraLockOn=null}return __extends(e,t),e.prototype.setPosition=function(t,e){var i=this.parentScene.getOrigin();t instanceof Point?this.position=t.add(i):this.position=new Point(t,e)},e.prototype.getPosition=function(){return this.position},e.prototype.getDepth=function(){return this.depth},e.prototype.setDepth=function(t){this.depth=t},e.prototype.setDepthPosition=function(t){this.depthPosition=t},e.prototype.getDepthPosition=function(){return this.depthPosition},e.prototype.setRotationPoint=function(t){this.rotationPoint=t},e.prototype.getRotationPoint=function(){return this.rotationPoint},e.prototype.setRotation=function(t){this.angle=t*Math.PI/180},e.prototype.getRotation=function(){return this.angle},e.prototype.getOrigin=function(){return new Point(this.position.x-Global.getScreenSize().width/2,this.position.y-Global.getScreenSize().height/2)},e.prototype.lockTo=function(t){this.isCameraLock=!0,this.cameraLockOn=t},e.prototype.unlock=function(){this.isCameraLock=!1,this.cameraLockOn=null},e.prototype.getLockElement=function(){return this.cameraLockOn},e.prototype.isLock=function(){return this.isCameraLock},e}(Scene),_elements=[],collisionGroups=[],collisionNumber=1,Elements=function(t){function e(e,i){void 0===e&&(e=100),t.call(this,{mass:e,position:[0,0],velocity:[0,0],angle:0,angularVelocity:0,force:[0,0],angularForce:0,fixedRotation:0}),this.drawables=[],this.datas=[],this.canCollide=[],this.isSensor=!1,this.haveCollision=!1,this.colGroup=0,this.eType="",this.shapeAngle=0,this.depth=0,this.static=i||!1,i||_elements.push(this),this.centred=!1}return __extends(e,t),e.prototype.setCentred=function(t){this.centred=t},e.prototype.isCentred=function(){return this.centred},e.prototype.getDepth=function(){return this.depth},e.prototype.setDepth=function(t){this.depth=t},e.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?p2.vec2.copy(t.position,e):p2.vec2.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this.shapes[0]&&(this.shapes[0].sensor=!0);for(var n=null,o=0;o<collisionGroups.length;++o)collisionGroups[o].name==this.getType()&&(n=collisionGroups[o].id);for(var s=0,r=this.canCollide.length-1;r>=0;r--)for(var h=collisionGroups.length-1;h>=0;h--)if(collisionGroups[h].name==this.canCollide[r]&&(s|=Math.pow(2,collisionGroups[h].id),0!=this.shapes.length))for(var a in this.shapes)this.shapes[a].collisionGroup=Math.pow(2,n);this.shapes[0]&&(this.shapes[0].collisionMask=s,this.isSensor||(this.shapes[0].sensor=!1))},e.prototype.setPosition=function(t,e){if(t instanceof Point?(this.position[0]=t.x,this.position[1]=t.y):(this.position[0]=t,this.position[1]=e),0!=this.getAssignedDrawables())for(var i=0;i<this.getAssignedDrawables().length;++i){var n=this.getAssignedDrawables()[i].getOffset(),o=this.getAssignedDrawables()[i].getSize();this.isCentred()?this.getAssignedDrawables()[i].setPosition(t+n.x-o.width/2,e+n.y-o.height/2):this.getAssignedDrawables()[i].setPosition(t+n.x,e+n.y)}if(this.shapes[0]&&this.shapes[0].hasOwnProperty("position")&&this.shapes[0].hasOwnProperty("width")&&this.shapes[0].hasOwnProperty("height")){this.shapes[0].position;this.shapes[0].position=[this.shapes[0].width/2,this.shapes[0].height/2]}},e.prototype.setRotation=function(t){if(this.angle=t*Math.PI/180,this.shapeAngle=t,0!=this.getAssignedDrawables())for(var e=0;e<this.getAssignedDrawables().length;++e)this.getAssignedDrawables()[e].setRotation(t)},e.prototype.getRotation=function(){return this.shapeAngle},e.prototype.getPosition=function(){return new Point(this.position[0],this.position[1])},e.prototype.assignDrawable=function(t){this.drawables.push(t),this.setPosition(this.getPosition().x,this.getPosition().y)},e.prototype.setDrawable=function(t,e){void 0===e&&(e=0),this.drawables[e]=t,this.setPosition(this.getPosition().x,this.getPosition().y)},e.prototype.getAssignedDrawables=function(){return this.drawables},e.prototype.setType=function(t){this.eType=t;var e=!1,i=0;for(var n in collisionGroups)collisionGroups[n].name!=this.getType()&&(e=!0,i=collisionGroups[n].id);e?this.setCollisionId(i):this.addCollisionGroup()},e.prototype.addCollisionGroup=function(){collisionGroups.push({id:collisionNumber,name:this.getType()}),this.setCollisionId(collisionNumber),collisionNumber++},e.prototype.getType=function(){return this.eType},e.prototype.setCollisionId=function(t){this.colGroup=t},e.prototype.getCollisionId=function(){return this.colGroup},e.prototype.setData=function(t,e){var i={name:t,value:e};this.datas.push(i)},e.prototype.getData=function(t){for(var e=null,i=this.datas.length-1;i>=0;i--)this.datas[i].name==t&&(e=this.datas[i].value);return e},e.prototype.setMass=function(t){this.mass=t,this.updateMassProperties()},e.prototype.getMass=function(){return this.mass},e.prototype.setFixedRotation=function(t){t?this.fixedRotation=1:this.fixedRotation=0},e.prototype.getFixedRotation=function(){return 1==this.fixedRotation},e.prototype.canCollideWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(t){for(var i=t.length-1;i>=0;i--)this.canCollide.push(t[i]);this.updateCollisions()}},e.prototype.updateCollisions=function(){for(var t=(this.canCollide,[]),e=this.canCollide.length-1;e>=0;e--)t.push({exists:!1,type:this.canCollide[e]});for(var e=t.length-1;e>=0;e--)for(var i in collisionGroups)collisionGroups[i].name==t[e].type&&(t[e].exists=!0);for(var e=t.length-1;e>=0;e--)0==t[e].exists&&(collisionGroups.push({id:collisionNumber,name:t[e].type}),collisionNumber++)},e.prototype.destroy=function(){this.world&&this.world.removeBody(this);for(var t=_elements.length-1;t>=0;t--)_elements[t]==this&&_elements.splice(t,1);delete this},e.prototype.setVelocity=function(t,e){this.velocity[0]=t,this.velocity[1]=e},e.prototype.getVelocity=function(){return{x:this.velocity[0],y:this.velocity[1]}},e}(p2.Body),Events=function(){function t(){this.events=[]}return t.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=!1,o=0;o<this.events.length;++o)this.events[o].name==t&&(n=!0);n||this.events.push({name:t,functions:[]});for(var o=0;o<this.events.length;++o)if(this.events[o].name==t)for(var s=0;s<this.events[o].functions.length;++s)this.events[o].functions[s].apply(null,e)},t.prototype.on=function(t,e){for(var i=!1,n=0;n<this.events.length;++n)this.events[n].name==t&&(i=!0);i||this.events.push({name:t,functions:[]});for(var n=0;n<this.events.length;++n)this.events[n].name==t&&this.events[n].functions.push(e)},t}(),Fonts;!function(t){var e=[],i=function(){function t(t,i){this.styleElement=document.createElement("style"),document.body.appendChild(this.styleElement),this.setName(t),this.setPath(i),e.push(this)}return t.prototype.updateCSS=function(){this.styleElement.innerHTML="@font-face{ font-family: "+this.getName()+"; src : url('"+this.getPath()+"');}"},t.prototype.setName=function(t){this.name=t,this.updateCSS()},t.prototype.setPath=function(t){this.path="./"+t,this.updateCSS()},t.prototype.getName=function(){return this.name},t.prototype.getPath=function(){return this.path},t}();t.FontFace=i}(Fonts||(Fonts={}));var Global;!function(t){function e(){return u}function i(){var t={height:null,width:null};return t="undefined"!=typeof document.body?{width:document.body.offsetWidth,height:document.body.offsetHeight}:{width:window.innerWidth,height:window.innerHeight}}function n(t,e,i,n){return isNaN(t)&&t.constructor==Point&&isNaN(e)&&e.constructor==Point?Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)):Math.sqrt(Math.pow(n-e,2)+Math.pow(i-t,2))}function o(t,e,i){var n=i.getOrigin();console.log("Cam position",n);var o=i.getDepth(),s={x:(n.x+t)/o,y:(n.y+e)/o};return new Point(s.x,s.y)}function s(t,e,i){var n=i.getOrigin(),o=i.getDepth(),s={x:(t-n.x)*o,y:(e-n.y)*o};return new Point(s.x,s.y)}function r(t,e,i,n){if(t instanceof Point&&e instanceof Point)var o=-(Math.atan2(e.x-t.y,e.y-t.y)*(180/Math.PI));else var o=-(Math.atan2(i-t,n-e)*(180/Math.PI));return o<0&&(o+=360),o}function h(t,e){return Math.random()*(e-t)+t}function a(t){return t<0?Math.ceil(t):Math.floor(t)}function l(){return!!window.hasOwnProperty("cordova")&&"android"==window.cordova.platformId}var u="1.0.0";t.getVersion=e,t.getScreenSize=i,t.getDistanceBetween2Points=n,t.getPositionFromScreen=o,t.getPositionFromWorld=s,t.findRotation=r,t.getRandom=h,t.getTrunc=a,t.isAndroid=l;var c=function(){function t(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.functionsToCallWhenReady=[],this.functionsToCallWhenLoaded=[];try{this.request=new XMLHttpRequest}catch(t){try{this.request=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{this.request=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}var o="GET";i[0]&&(o=i[0]),console.log(o,t),this.request.open(o,t,!0),i[1]&&(this.request.responseType=i[1]),this.request.send(null),this.request.addEventListener("readystatechange",function(t){if(e.functionsToCallWhenReady)for(var i=0;i<e.functionsToCallWhenReady.length;i++)e.functionsToCallWhenReady[i](e.request,t)}),this.request.addEventListener("load",function(){if(e.functionsToCallWhenLoaded)for(var t=0;t<e.functionsToCallWhenLoaded.length;t++)e.functionsToCallWhenLoaded[t](e.request)})}return t.prototype.ready=function(t){this.functionsToCallWhenReady.push(t)},t.prototype.load=function(t){this.functionsToCallWhenLoaded.push(t)},t}();t.XHR=c}(Global||(Global={}));var Grid;!function(t){var e=function(){function t(t,e,i,n){this.position={x:0,y:0},this.size={width:t,height:e},this.parentScene=n,this.tiles=[],this.type="grid",this.tileSize=i,this.table=[];for(var o=0;o<Math.ceil(this.size.width/this.tileSize);++o){this.table[o]=[];for(var s=0;s<Math.ceil(this.size.height/this.tileSize);++s)this.table[o][s]=[]}}return t.prototype.setSize=function(t,e){this.size={width:t,height:e}},t.prototype.getSize=function(){return this.size},t.prototype.setTileSize=function(t){this.tileSize=t},t.prototype.getTileSize=function(){return this.tileSize},t.prototype.getTiles=function(){return this.tiles},t.prototype.addTile=function(t){var e=t.getPositionIntoGrid();this.table[e.x]||(this.table[e.x]=[]),this.table[e.x][e.y]||(this.table[e.x][e.y]=[]),this.table[e.x][e.y]=t,this.tiles.push(t)},t.prototype.setType=function(t){this.type=t},t.prototype.getType=function(){return this.type},t.prototype.getTileFromPosition=function(t,e,i){if(i){var n=this.table[t][e];return!!n&&n}for(var o=this.getPosition(),s=this.getTileSize(),r=this.table.length-1;r>=0;r--)for(var h=this.table[r].length-1;h>=0;h--){var a={x:o.x+s*r,y:o.y+s*h};if(t>=a.x&&t<=a.x+s&&e>=a.y&&e<=a.y+s){var l=this.table[a.x/s][a.y/s];return{tile:l,gridPos:{x:a.x/s,y:a.y/s}}}}},t.prototype.getPosition=function(){return this.position},t.prototype.setPosition=function(t,e){this.position={x:t,y:e}},t}();t.Grid=e;var i=function(t){function e(e,i,n){t.call(this),this.setType("tile"),this.canCollideWith("player"),this.setMass(0),this.parentGrid=e,this.gridPos={x:i,y:n},this.parentGrid.addTile(this)}return __extends(e,t),e.prototype.getParentGrid=function(){return this.parentGrid},e.prototype.getPositionIntoGrid=function(){return this.gridPos},e}(Elements);t.Tile=i}(Grid||(Grid={}));var Input;!function(t){function e(){requestAnimationFrame(e);for(var t=i.length-1;t>=0;t--)i[t]&&i[t].event.emit("down",i[t].key,i[t].code)}var i=[],n={holdTime:300},o=function(t){function e(){t.call(this);var e=this;window.addEventListener("mousemove",function(t){e.emit("move",t.clientX,t.clientY)})}return __extends(e,t),e}(Events);t.MouseMove=o;var s=function(t){function e(e,i,o,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=window.innerWidth),void 0===s&&(s=window.innerHeight),t.call(this),this.x=e,this.y=i,this.width=o,this.height=s;var r=null,h=this;document.addEventListener("mouseup",function(t){if(t.clientX>=h.x&&t.clientX<=h.x+h.width&&t.clientY>=h.y&&t.clientY<=h.y+h.height){var e="";switch(t.button){case 0:e="left";break;case 1:e="middle";break;case 2:e="right"}h.emit("up",t.clientX,t.clientY,e),r=!1}}),document.addEventListener("mousedown",function(t){if(t.clientX>=h.x&&t.clientX<=h.x+h.width&&t.clientY>=h.y&&t.clientY<=h.y+h.height){var e="";switch(t.button){case 0:e="left";break;case 1:e="middle";break;case 2:e="right"}h.emit("down",t.clientX,t.clientY,e),r=!0;var i=t;setTimeout(function(){r&&h.emit("hold",i.clientX,i.clientY,e)},n.holdTime)}})}return __extends(e,t),e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.setSize=function(t,e){this.width=t,this.height=e},e}(Events);t.Mouse=s;var r=function(t){function e(e,i,n,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=window.innerWidth),void 0===o&&(o=window.innerHeight),t.call(this),this.x=e,this.y=i,this.width=n,this.height=o;var s=this;window.addEventListener("click",function(t){t.clientX>=s.x&&t.clientX<=s.x+s.width&&t.clientY>=s.y&&t.clientY<=s.y+s.height?s.emit("click",t.clientX,t.clientY):s.emit("out",t.clientX,t.clientY)})}return __extends(e,t),e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.setSize=function(t,e){this.width=t,this.height=e},e}(Events);t.Click=r;var h=function(t){function e(e,i,o,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=window.innerWidth),void 0===s&&(s=window.innerHeight),t.call(this),this.x=e,this.y=i,this.width=o,this.height=s;var r=!1,h=this;document.body.addEventListener("touchstart",function(t){for(var e=t.changedTouches.length-1;e>=0;e--)if(t.changedTouches[e].clientX>=h.x&&t.changedTouches[e].clientX<=h.x+h.width&&t.changedTouches[e].clientY>=h.y&&t.changedTouches[e].clientY<=h.y+h.height){var i=t.changedTouches[e];h.emit("press",i.clientX,i.clientY,t.touches),r=!0,setTimeout(function(){r&&h.emit("hold",i.clientX,i.clientY,t.touches)},n.holdTime)}},!1),document.body.addEventListener("touchend",function(t){for(var e=t.changedTouches.length-1;e>=0;e--)t.changedTouches[e].clientX>=h.x&&t.changedTouches[e].clientX<=h.x+h.width&&t.changedTouches[e].clientY>=h.y&&t.changedTouches[e].clientY<=h.y+h.height&&(h.emit("release",t.changedTouches[e].clientX,t.changedTouches[e].clientY,t.touches),r=!1)},!1),document.body.addEventListener("touchmove",function(t){for(var e=t.changedTouches.length-1;e>=0;e--)t.changedTouches[e].clientX>=h.x&&t.changedTouches[e].clientX<=h.x+h.width&&t.changedTouches[e].clientY>=h.y&&t.changedTouches[e].clientY<=h.y+h.height&&h.emit("move",t.changedTouches[e].clientX,t.changedTouches[e].clientY,t.touches);t.preventDefault()},!1)}return __extends(e,t),e.prototype.setPosition=function(t,e){this.x=t,this.y=e},e.prototype.setSize=function(t,e){this.width=t,this.height=e},e}(Events);t.Touch=h;var a=function(t){function e(){for(var e=this,n=[],o=0;o<arguments.length;o++)n[o-0]=arguments[o];t.call(this);var s=this;this.keyPressed=null,n[0]&&(this.keyPressed=n[0]),window.addEventListener("keydown",function(t){e.keyPressed?e.keyPressed!=t.key&&e.keyPressed!=t.keyCode&&e.keyPressed!=t.charCode||i.push({key:t.key,code:t.keyCode,event:e}):s.emit("down",t.key,t.keyCode,t.charCode)}),window.addEventListener("keyup",function(t){if(null!=e.keyPressed){if(e.keyPressed==t.key||e.keyPressed==t.keyCode||e.keyPressed==t.charCode){s.emit("up",t.key,t.keyCode,t.charCode);for(var n=i.length-1;n>=0;n--)i[n]&&(i[n].key!=t.key&&i[n].code!=t.keyCode||delete i[n])}}else s.emit("up",t.key,t.keyCode,t.charCode)})}return __extends(e,t),e.prototype.setKey=function(t){this.keyPressed=t},e}(Events);t.Key=a,e();var l=function(t){function e(){t.call(this);var e=this;window.addEventListener("DOMMouseScroll",function(t){t&&(t.detail&&t.detail>0?e.emit("down"):e.emit("up"))})}return __extends(e,t),e}(Events);t.Scroll=l;var u=function(t){function e(){var e=this;t.call(this),this.isActive=!0,this.gamepads=[],this.states=[{},{},{},{}],this.rounded=!1,this.roundedDecimal=10;var i=this;window.addEventListener("gamepadconnected",function(t){e.gamepads=navigator.getGamepads(),i.emit("connected",t)}),window.addEventListener("gamepaddisconnected",function(t){e.gamepads=navigator.getGamepads(),i.emit("disconnected",t)}),requestAnimationFrame(function(){e.checkChanges()})}return __extends(e,t),e.prototype.isRounded=function(t){this.rounded=t},e.prototype.setRoundDecimal=function(t){this.roundedDecimal=t},e.prototype.getGamepads=function(){return this.gamepads},e.prototype.getRealGamepads=function(){for(var t=[],e=navigator.getGamepads(),i=0;i<e.length;++i)void 0!=e[i]&&0!=e[i].timestamp&&t.push(e[i]);this.gamepads=t},e.prototype.checkChanges=function(){var t=this;this.getRealGamepads();for(var e=!1,i=0;i<this.gamepads.length;++i)this.gamepads[i].connected&&(e=!0);if(this.isActive=e,this.isActive&&this.gamepads)for(var n=0;n<this.gamepads.length;++n){for(var o=0;o<this.gamepads[n].buttons.length;++o){var s=this.gamepads[n].buttons[o];s.pressed?0!=this.states[n]["button-"+o]&&void 0!=this.states[n]["button-"+o]||(this.states[n]["button-"+o]=!0,this.emit("buttonpressed",o)):this.states[n]["button-"+o]&&(this.emit("buttonreleased",o),this.states[n]["button-"+o]=!1)}for(var r=0;r<this.gamepads[n].axes.length;++r){var h=this.gamepads[n].axes[r];void 0==this.states[n]["axes-"+r]&&(this.rounded?this.states[n]["axes-"+r]=parseInt(h.toFixed(this.roundedDecimal)):this.states[n]["axes-"+r]=parseInt(h)),this.states[n]["axes-"+r]!=parseInt(this.rounded?h.toFixed(this.roundedDecimal):h)&&(this.rounded?(this.emit("joystick",r,parseInt(h.toFixed(this.roundedDecimal)),this.states[n]["axes-"+r]),this.states[n]["axes-"+r]=parseInt(h.toFixed(this.roundedDecimal))):(this.emit("joystick",r,parseInt(h),this.states[n]["axes-"+r]),this.states[n]["axes-"+r]=parseInt(h)))}}requestAnimationFrame(function(){t.checkChanges()})},e}(Events);t.Gamepad=u,window.addEventListener("contextmenu",function(t){t.preventDefault()})}(Input||(Input={}));var UI;!function(t){function e(){for(var t=!1,e=s.length-1;e>=0;e--)s[e].isFocused(null)&&(t=!0);return t}function i(t){o=t}function n(){return o}var o=null,s=[];t.isInputEnabled=e,t.setUsedCanvas=i,t.getUsedCanvas=n}(UI||(UI={}));var Point=function(){function t(t,e){this.x=t||0,this.y=e||0}return t.prototype.set=function(t,e){this.x=t,this.y=e},t.prototype.setX=function(t){this.x=t},t.prototype.getX=function(){return this.x},t.prototype.setY=function(t){this.y=t},t.prototype.getY=function(){return this.y},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.diff=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.remplace=function(t){this.x=t.x,this.y=t.y},t.prototype.addX=function(t){this.x+=t},t.prototype.addY=function(t){this.y+=t},t}(),Vector=function(){function t(t){this.position=t}return t.prototype.getLength=function(){return Math.sqrt(this.position.x*this.position.x+this.position.y*this.position.y)},t.prototype.getPosition=function(){return this.position},t}(),Scene=function(){function t(){this.origin=new Point(0,0)}return t.prototype.getOrigin=function(){return this.origin},t}(),Update;!function(t){function e(t){r=t,requestAnimationFrame(o)}function i(t){h=t}function n(t){a=t}function o(t){requestAnimationFrame(o);for(var e=0;e<_elements.length;e++){var i=_elements[e].getPosition();_elements[e].setPosition(i.x,i.y),_elements[e].setRotation(_elements[e].getRotation())}if(h&&h.isLock()){var n=h.getLockElement().getPosition();h.setPosition(n.x,n.y)}for(var s=0;s<l.length;s++)l[s](t);var d=void 0!==t&&void 0!==u?t/1e3-u:0;a?r.step(c):r.step(c,d,p),u=t/1e3}function s(t){l.push(t)}var r=null,h=null,a=!0,l=[];t.world=e,t.camera=i,t.setUseFPS=n;var u,c=1/60,p=10;t.on=s}(Update||(Update={}));var Render;!function(t){function e(t){c=t}function i(){return c}function n(t){var e={element:t,downloaded:!1};d.push(e)}function o(t,e){void 0===e&&(e="aabb"),g.active=t,g.type=e}function s(){return y}function r(t){y=t}function h(){var t=0;if(0==d.length)for(var e=f.length-1;e>=0;e--)f[e]();for(var e=d.length-1;e>=0;e--){var i=new Image;i.src=p+d[e].element;var n=d[e].element;i.addEventListener("load",function(){for(var e=d.length-1;e>=0;e--)if(d[e].element==n){d[e].downloaded=!0;for(var i=d.length-1;i>=0;i--)1==d[i].downloaded&&(t+=1)}if(t==d.length)for(var e=f.length-1;e>=0;e--)f[e]()})}}function a(t){f.push(t)}function l(e){var n=e.getCanvas(),o=e.getContext(),s=e.getElements();if(o&&n){var r=Global.getScreenSize();o.clearRect(0,0,r.width,r.height),o.save();var h=i();if(e.isSmooth()||(o.mozImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1),s.sort(function(t,e){return t.depth=t.depth||0,e.depth=e.depth||0,t.depth<e.depth?-1:t.depth>e.depth?1:0}),e.affectedByCamera&&h){h.getDepth();if(o.translate(r.width/2,r.height/2),o.scale(h.getDepth(),h.getDepth()),o.translate(-r.width/2,-r.height/2),o.translate(r.width/2,r.height/2),o.rotate(h.getRotation()*Math.PI/180),o.translate(-r.width/2,-r.height/2),0!=h.getRotation()){var a=h.getRotationPoint();o.translate(a.x,a.y),o.rotate(h.getRotation()),o.translate(-a.x,-a.y)}}if(s)for(var l=0;l<s.length;l++)if(s[l])if(v=s[l],"drawable"!=v.getType())switch(v.getType()){case"grid":for(var p=v,d=p.getTiles(),f=d.length-1;f>=0;f--){var y=d[f].getPositionIntoGrid(),m={x:y.x*p.getTileSize(),y:y.y*p.getTileSize()};v=d[f].getAssignedDrawables()[0];var w=v.getSize(),x={x:m.x,y:m.y};if(e.affectedByCamera&&h){var P=h.getPosition(),S=h.getDepth()+1;v.isFixed()||(x.x=m.x+(n.width/2-P.x)/S,x.y=m.y+(n.height/2-P.y)/S)}u(o,v,x,w)}break;case"draw":var C=v.getPosition();C||(C=v.absolutePosition);var b=v.getShape();if("line"==b)var T=v.getTarget(),E={x:T.x,y:T.y};var w=v.getSize(),k={x:C.x,y:C.y};if(e.affectedByCamera&&h){var M=h.getPosition();v.isFixed()||(k.x=C.x+(n.width/2-M.x),k.y=C.y+(n.height/2-M.y),E&&T&&(E.x=T.x+(n.width/2-M.x),E.y=T.y+(n.height/2-M.y)))}u(o,v,k,w,E);break;default:for(var z=v.getAssignedDrawables(),f=0;f<z.length;++f)if(z[f]){var C=z[f].getPosition(),w=z[f].getSize();if(t.getCamera()){var M=t.getCamera().getPosition(),S=t.getCamera().getDepth()+1;z[f].isFixed()||(C.x=C.x+(n.width/2-M.x)/S,C.y=C.y+(n.height/2-M.y)/S)}u(o,z[f],C,w)}}else{var R=v.getPosition(),w=v.getSize();if(e.affectedByCamera&&c){var P=c.getPosition(),S=c.getDepth()+1;v.isFixed()||(R.x=R.x+(n.width/2-P.x)/S,R.y=R.y+(n.height/2-P.y)/S)}u(o,v,R,w)}if(g.active)for(var f=_elements.length-1;f>=0;f--){o.lineWidth=2,o.beginPath(),o.strokeStyle="#00FF00";var F=_elements[f].getPosition();if("vertices"==g.type){if(_elements[f].shapes[0]&&_elements[f].shapes[0].vertices)for(var D=_elements[f].shapes[0].vertices,_=!0,l=0;l<D.length;++l)_?(o.moveTo(F.x+D[l][0]+_elements[f].shapes[0].width/2,F.y+D[l][1]+_elements[f].shapes[0].height/2),_=!1):o.lineTo(F.x+D[l][0]+_elements[f].shapes[0].width/2,F.y+D[l][1]+_elements[f].shapes[0].height/2)}else if(_elements[f].aabb&&0!=_elements[f].aabb.lowerBound[0]){var L=_elements[f].aabb,I=Global.getPositionFromWorld(L.lowerBound[0],L.lowerBound[1],c),G=Global.getPositionFromWorld(L.upperBound[0],L.upperBound[1],c);o.moveTo(I.x,I.y),o.lineTo(G.x,I.y),o.lineTo(G.x,G.y),o.lineTo(I.x,G.y)}o.closePath(),o.stroke()}o.restore()}}function u(e,i,n,o,s){void 0===s&&(s=null),n.x=Math.floor(n.x),n.y=Math.floor(n.y),s&&(s.x=Math.floor(s.x),s.y=Math.floor(s.y)),o.width=o.width||1,o.height=o.height||1;var r=t.getCamera(),h=(r.getDepth(),{x:0,y:0});if(n.x>-o.width-h.x&&n.x<=Global.getScreenSize().width+o.width+h.x&&n.y>-o.height-h.y&&n.y<=Global.getScreenSize().height+o.height+h.y&&i.isVisible(null)){e.save(),e.globalAlpha=i.getOpacity(),i.isSmooth()||(e.mozImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1),i.isFlipped(null)&&(e.scale(-1,1),n.x=-n.x-o.width,s&&(s.x=-s.x-o.width));var a=i.getRotationPoint();if(i.fixedToCenter&&(a.x=n.x+o.width/2,a.y=n.y+o.height/2),0!=i.getRotation()&&(e.translate(a.x,a.y),e.rotate(i.getRotation()*(Math.PI/180)),e.translate(-a.x,-a.y)),"draw"==i.getType()){switch(e.fillStyle=i.getColor(),0!=i.getStrokeSize()&&(e.lineWidth=i.getStrokeSize(),e.strokeStyle=i.getStrokeColor()),i.isShadowEnabled()&&(e.shadowColor=i.getShadowColor(),e.shadowBlur=i.getShadowBlur(),e.shadowOffsetX=i.getShadowPosition().x,e.shadowOffsetY=i.getShadowPosition().y),i.getShape()){case"rectangle":e.beginPath(),e.rect(Math.ceil(a.x-o.width/2),Math.ceil(a.y-o.height/2),Math.ceil(o.width),Math.ceil(o.height)),e.closePath();break;case"circle":e.beginPath(),e.arc(Math.ceil(a.x-o.width/2),Math.ceil(a.y-o.height/2),i.getRadius(),0,2*Math.PI,!1),e.closePath();break;case"polygon":e.beginPath();for(var l=0;l<i.getVertices().length;++l){var u=i.getVertices()[l];0==l?e.moveTo(u.x+n.x,u.y+n.y):e.lineTo(u.x+n.x,u.y+n.y)}e.closePath();break;case"line":e.beginPath(),e.moveTo(Math.ceil(a.x-o.width/2),Math.ceil(a.y-o.height/2)),e.lineTo(Math.ceil(s.x),Math.ceil(s.y)),e.closePath();break;case"text":e.font=i.getFontStyle()+" "+i.getFontSize()+"px "+i.getFont(),e.textBaseline=i.getBaseline(),0!=i.getStrokeSize()&&e.strokeText(i.getValue(),Math.ceil(a.x-o.width/2),Math.ceil(a.y-o.height/2));var c=new String(i.getValue()),p=i.getValue().length,d=i.getFontSize(),f=p*d,o=i.getSize(),y=Math.ceil(f/o.width),v=1.8*Math.floor(o.width/d),m=[];f>o.width&&(y-=1);for(var l=0;l<y;l++)m[l]=[];for(var w=0,x=0,P=0;P<c.length;P++)w<v?(m[x].push(c[P]),w++):(w=0,x++,m[x]||(m[x]=[]),m[x].push(c[P]));var S=i.getAlign(),C=i.getVerticalAlign();e.textAlign=S;for(var b=(d*m.length,{x:0,y:0}),l=0;l<m.length;l++){for(var T="",E=0;E<m[l].length;E++)T+=m[l][E];"middle"==C&&(b.y=b.y+d),"center"==S&&(b.x=o.width/2),e.fillText(T,Math.ceil(a.x-o.width/2)+b.x,Math.ceil(a.y-o.height/2)+l*d-d/4+b.y)}break;case"point":e.beginPath(),e.moveTo(Math.ceil(a.x-o.width/2)-5,Math.ceil(a.y-o.height/2)),e.lineTo(Math.ceil(a.x-o.width/2)+5,Math.ceil(a.y-o.height/2)),e.moveTo(Math.ceil(a.x-o.width/2),Math.ceil(a.y-o.height/2)-5),e.lineTo(Math.ceil(a.x-o.width/2),Math.ceil(a.y-o.height/2)+5),e.closePath()}"text"!=i.getShape()&&e.fill(),0!=i.getStrokeSize()&&e.stroke()}else{var k=null;if(k=0!=i.getRotation()?{x:a.x-o.width/2,y:a.y-o.height/2}:n,0!=i.getData())if(i.isSprite()){var M=i.getCurrentFrame(),z=i.getFrameSize(),R=i.getFrameLine();e.drawImage(i.getData(),Math.ceil(z.width*M),Math.ceil(z.height*R),Math.ceil(z.width),Math.ceil(z.height),Math.ceil(k.x),Math.ceil(k.y),Math.ceil(o.width),Math.ceil(o.height))}else{var F=null;F=i.isCropped()?i.getCrop():{x:0,y:0,width:i.getData().width,height:i.getData().height},e.drawImage(i.getData(),F.x,F.y,F.width,F.height,Math.ceil(k.x),Math.ceil(k.y),Math.ceil(o.width),Math.ceil(o.height))}}if(g.active){e.lineWidth=4,e.strokeStyle="#FF0000";var D=n;e.strokeRect(D.x,D.y,o.width,o.height)}e.restore()}}var c=null,p="./",d=[],f=[],g={active:!1,type:"aabb"},y=null;t.setCamera=e,t.getCamera=i,t.add=n,t.setDebugMode=o,t.getWorld=s,t.setWorld=r,t.download=h,t.ready=a;var v;t.updateRender=l}(Render||(Render={}));var Render;!function(t){var e=[],i=function(){function i(){var t=this;this.elements=[],this.canvasElement=document.createElement("canvas"),this.context=this.canvasElement.getContext("2d");var i=Global.getScreenSize();this.canvasElement.width=i.width,this.canvasElement.height=i.height,document.body.appendChild(this.canvasElement),window.addEventListener("resize",function(){var e=Global.getScreenSize();t.canvasElement.width=e.width,t.canvasElement.height=e.height}),this.render(),this.smooth=!0,this.affectedByCamera=!1,e.push(this)}return i.prototype.render=function(){var e=this;t.updateRender(this),window.requestAnimationFrame(function(){e.render()})},i.prototype.set=function(t){this.elements.push(t)},i.prototype.del=function(t){for(var e=this.elements.length-1;e>=0;e--)this.elements[e]==t&&(this.elements.splice(e,1),delete this.elements[e])},i.prototype.getContext=function(){return this.context},i.prototype.getCanvas=function(){return this.canvasElement},i.prototype.getElements=function(){return this.elements},i.prototype.setSmooth=function(t){this.smooth=t},i.prototype.isSmooth=function(){return this.smooth},i}();t.Layer=i}(Render||(Render={}));var Render;!function(t){var e="./",i=function(){function t(t){this.src=e+t,this.data=new Image,this.data.src=e+t}return t.prototype.getData=function(){return!!this.data&&this.data},t.prototype.setSrc=function(t){this.data.src=e+t,this.src=e+t},t.prototype.onLoad=function(t){var e=t,i=this;this.getData().addEventListener("load",function(){e(i)})},t}();t.Texture=i}(Render||(Render={}));var Render;!function(t){var e=function(){function t(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.texture=t,null==t?this.setSize(0,0):this.setSize(t.getData().width,t.getData().height),this.setPosition(0,0),null!=e[0]&&null!=e[1]&&this.setPosition(e[0],e[1]),null!=e[2]&&null!=e[3]&&this.setSize(e[2],e[3]),this.depth=0,this.rotation=0,this.opacity=1,this.type="drawable",this.flipped=!1,this.fixedToCenter=!0,this.rotationPoint={x:0,y:0},this.visible=!0,this.smooth=!0,this.offset={x:0,y:0},this.haveCrop=!1,this.crop={x:0,y:0,width:this.size.width,height:this.size.height}}return t.prototype.isCropped=function(){return this.haveCrop},t.prototype.setCrop=function(t,e,i,n){this.haveCrop=!0,this.crop={x:t,y:e,width:i,height:n}},t.prototype.getCrop=function(){return this.crop},t.prototype.getOffset=function(){return this.offset},t.prototype.setOffset=function(t,e){this.offset={x:t,y:e}},t.prototype.setPosition=function(t,e){this.position={x:t,y:e}},t.prototype.getPosition=function(){return this.position},t.prototype.getSize=function(){return this.size},t.prototype.setSize=function(t,e){this.size={width:t,height:e}},t.prototype.getData=function(){return null!==this.texture&&this.texture.getData()},t.prototype.getDepth=function(){return this.depth},t.prototype.setDepth=function(t){this.depth=t},t.prototype.setRotation=function(t){this.rotation=t},t.prototype.getRotation=function(){return this.rotation},t.prototype.getOpacity=function(){return this.opacity},t.prototype.setOpacity=function(t){this.opacity=t},t.prototype.isSprite=function(t){return 1!=t&&0!=t?this.sprite:void(this.sprite=t)},t.prototype.setFixed=function(t){this.fixed=t},t.prototype.isFixed=function(){return this.fixed},t.prototype.setType=function(t){this.type=t},t.prototype.getType=function(){return this.type},t.prototype.isFlipped=function(t){return 1!=t&&0!=t?this.flipped:void(this.flipped=t)},t.prototype.setRotationPoint=function(t,e){this.fixedToCenter=!1,this.rotationPoint={x:t,y:e}},t.prototype.getRotationPoint=function(){return this.rotationPoint},t.prototype.isVisible=function(){return this.visible},t.prototype.setVisible=function(t){this.visible=t},t.prototype.setLayout=function(t){this.layout=t},t.prototype.setSmooth=function(t){this.smooth=t},t.prototype.isSmooth=function(){return this.smooth},t}();t.Drawable=e}(Render||(Render={}));var Render;!function(t){var e=function(t){function e(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];t.call(this,e),this.sprite=!0,this.currentFrame=0,this.fps=10,this.frameLine=i[7]||0,this.position={x:i[0],y:i[1]}||this.position,this.size={width:i[2],height:i[3]}||this.size,this.frameSize={width:i[4],height:i[5]},this.frameAmount=i[6]||0,this.loop=!1,this.loopFinished=!1;var o=this;this.currentInterval=setInterval(function(){var t=o.getCurrentFrame();o.loop?0==o.loopFinished&&(o.setCurrentFrame(t+=1),t==o.getFrameAmount()-1&&(o.loopFinished=!0)):o.setCurrentFrame(t+=1)},1e3/this.fps)}return __extends(e,t),e.prototype.setFrameSize=function(t,e){this.frameSize={width:t,height:e}},e.prototype.getFrameSize=function(){return this.frameSize},e.prototype.setFrameAmount=function(t){this.frameAmount=t},e.prototype.getFrameAmount=function(){return this.frameAmount},e.prototype.setCurrentFrame=function(t){t>=this.frameAmount?this.currentFrame=0:this.currentFrame=t;
},e.prototype.getCurrentFrame=function(){return this.currentFrame},e.prototype.setFrameLine=function(t){this.frameLine=t},e.prototype.getFrameLine=function(){return this.frameLine},e.prototype.setFrameSpeed=function(t){this.fps=t;var e=this;clearInterval(this.currentInterval),this.currentInterval=setInterval(function(){var t=e.getCurrentFrame();e.loop?0==e.loopFinished&&(e.setCurrentFrame(t+=1),t==e.getFrameAmount()-1&&(e.loopFinished=!0)):e.setCurrentFrame(t+=1)},1e3/this.fps)},e.prototype.getFrameSpeed=function(){return this.fps},e.prototype.setFreeze=function(t){this.freezed=t,t?clearInterval(this.currentInterval):this.setFrameSpeed(this.fps)},e.prototype.setUniqueLoop=function(t){this.loop=t},e.prototype.playUniqueLoop=function(){this.loop&&(this.loopFinished=!1,this.setCurrentFrame(0))},e}(t.Drawable);t.Sprite=e}(Render||(Render={}));var Render;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this,null),this.type="draw",this.shape=null,this.strokeSize=0,this.color="#000",this.shadowEnabled=!1,this.shadowColor="#000000",this.shadowBlur=0,this.shadowPosition={x:0,y:0}}return __extends(e,t),e.prototype.setColor=function(t){this.color=t},e.prototype.getColor=function(){return this.color},e.prototype.setStrokeSize=function(t){this.strokeSize=t},e.prototype.getStrokeSize=function(){return this.strokeSize},e.prototype.setStrokeColor=function(t){this.strokeColor=t},e.prototype.getStrokeColor=function(){return this.strokeColor},e.prototype.getShape=function(){return this.shape},e.prototype.setShadow=function(t){this.shadowEnabled=t},e.prototype.isShadowEnabled=function(){return this.shadowEnabled},e.prototype.setShadowColor=function(t){this.shadowColor=t},e.prototype.getShadowColor=function(){return this.shadowColor},e.prototype.setShadowBlur=function(t){this.shadowBlur=t},e.prototype.getShadowBlur=function(){return this.shadowBlur},e.prototype.setShadowPosition=function(t,e){this.shadowPosition={x:t,y:e}},e.prototype.getShadowPosition=function(){return this.shadowPosition},e}(t.Drawable);e.Draw=i}(e=t.Draw||(t.Draw={}))}(Render||(Render={}));var Render;!function(t){var e;!function(t){var e=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];t.call(this),this.shape="rectangle",this.position.x=e[0]||this.position.x,this.position.y=e[1]||this.position.y,this.size.width=e[2]||this.size.width,this.size.height=e[3]||this.size.height,this.setColor(e[4]||"#FFFFFF")}return __extends(e,t),e}(t.Draw);t.Rectangle=e}(e=t.Draw||(t.Draw={}))}(Render||(Render={}));var Render;!function(t){var e;!function(t){var e=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];t.call(this),this.shape="circle",this.position.x=e[0]||this.position.x,this.position.y=e[1]||this.position.y,this.radius=e[2]||this.radius,this.setSize(2*this.getRadius(),2*this.getRadius())}return __extends(e,t),e.prototype.setRadius=function(t){this.radius=t},e.prototype.getRadius=function(){return this.radius},e}(t.Draw);t.Circle=e}(e=t.Draw||(t.Draw={}))}(Render||(Render={}));var Render;!function(t){var e;!function(t){var e=function(t){function e(e){t.call(this),this.shape="polygon",this.vertices=e;for(var i=[],n=[],o=0;o<this.vertices.length;++o)i.push(this.vertices[o].x),n.push(this.vertices[o].y);var s=Math.min.apply(null,i),r=Math.max.apply(null,i),h=Math.min.apply(null,n),a=Math.max.apply(null,n);this.setSize(r-s,a-h)}return __extends(e,t),e.prototype.getVertices=function(){return this.vertices},e.prototype.setVerticePosition=function(t,e,i){this.vertices[t]&&(this.vertices[t].x=e,this.vertices[t].y=i)},e}(t.Draw);t.Polygon=e}(e=t.Draw||(t.Draw={}))}(Render||(Render={}));var Render;!function(t){var e;!function(t){var e=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];t.call(this),this.target={x:null,y:null},this.shape="line",this.position.x=e[0]||this.position.x,this.position.y=e[1]||this.position.y,this.target.x=e[2]||this.target.x,this.target.y=e[3]||this.target.y}return __extends(e,t),e.prototype.setTarget=function(t,e){this.target={x:t,y:e}},e.prototype.getTarget=function(){return this.target},e}(t.Draw);t.Line=e}(e=t.Draw||(t.Draw={}))}(Render||(Render={}));var Render;!function(t){var e;!function(t){var e=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];t.call(this),this.shape="text",this.value="",this.setFont("Arial"),this.setFontSize(15),this.fontStyle="normal",this.setBaseline("top"),this.setAlign("start"),this.setVerticalAlign("top"),this.position.x=e[0]||this.position.x,this.position.y=e[1]||this.position.y,e[3]&&e[4]&&this.setSize(e[3],e[4]),this.value=e[2]||this.value}return __extends(e,t),e.prototype.getValue=function(){return this.value},e.prototype.setValue=function(t){this.value=t},e.prototype.setFont=function(t){this.font=t},e.prototype.getFont=function(){return this.font},e.prototype.setFontSize=function(t){this.fontSize=t},e.prototype.getFontSize=function(){return this.fontSize},e.prototype.setFontStyle=function(t){this.fontStyle=t},e.prototype.getFontStyle=function(){return this.fontStyle},e.prototype.setBaseline=function(t){this.baseLine=t},e.prototype.getBaseline=function(){return this.baseLine},e.prototype.setAlign=function(t){this.align=t},e.prototype.getAlign=function(){return this.align},e.prototype.setVerticalAlign=function(t){this.verticalAlign=t},e.prototype.getVerticalAlign=function(){return this.verticalAlign},e.prototype.setMultiline=function(t){this.isMultiline=t},e}(t.Draw);t.Text=e}(e=t.Draw||(t.Draw={}))}(Render||(Render={}));var Render;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.setPosition(e,i),this.setColor("#000000"),this.shape="point",this.setStrokeSize(1)}return __extends(e,t),e}(t.Draw);t.Point=e}(e=t.Draw||(t.Draw={}))}(Render||(Render={}));var UI;!function(t){var e=function(t){function e(){var e=this;t.call(this),this.isHTML=!1,this.htmlElement=null,this.renderElements=[],this.parent=null,this.childrens=[],this.events={},this.functionsToCall={},this.functionsToCallWhenOut={},this.guiType=null,this.relativePosition={x:0,y:0},this.absolutePosition={x:0,y:0};var i=this.getPosition(!1),n=this.getSize();this.functionsToCall.click=[],this.functionsToCallWhenOut.click=[];var o=this;this.events.click=new Input.Click(i.x,i.y,n.width,n.height),this.events.click.on("click",function(){for(var t=0;t<e.functionsToCall.click.length;++t)e.functionsToCall.click[t]()}),this.events.click.on("out",function(){for(var t=0;t<e.functionsToCallWhenOut.click.length;++t)e.functionsToCallWhenOut.click[t]()}),this.functionsToCall.hover=[],this.events.hover=new Input.MouseMove,this.events.hover.on("move",function(t,i){var n=o.getPosition(!1),s=o.getSize();if(t>=n.x&&i>=n.y&&t<=n.x+s.width&&i<=n.y+s.height)for(var r=0;r<e.functionsToCall.hover.length;++r)e.functionsToCall.hover[r]()}),this.functionsToCall.leave=[],this.events.leave=new Input.MouseMove,this.events.leave.on("move",function(t,i){var n=o.getPosition(!1),s=o.getSize();if(!(t>=n.x&&i>=n.y&&t<=n.x+s.width&&i<=n.y+s.height))for(var r=0;r<e.functionsToCall.leave.length;++r)e.functionsToCall.leave[r]()})}return __extends(e,t),e.prototype.setParent=function(t){this.parent=t,this.parent.setChildren(this)},e.prototype.getParent=function(){return this.parent},e.prototype.setPosition=function(t,e){if(this.isHTML)this.htmlElement.style.position="absolute",this.htmlElement.style.top=e+"px",this.htmlElement.style.left=t+"px";else{if(this.getParent()){var i=this.getParent(),n=i.getPosition(!1);this.relativePosition={x:t,y:e},this.absolutePosition={x:n.x+t,y:n.y+e}}else this.relativePosition={x:t,y:e},this.absolutePosition={x:t,y:e};for(var o in this.events){var s=this.getPosition(!1);this.events[o].x=s.x,this.events[o].y=s.y}}},e.prototype.getPosition=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 1==t[0]?this.relativePosition:0==t[0]?this.absolutePosition:void 0},e.prototype.setSize=function(t,e){this.size={width:t,height:e};for(var i in this.events)this.events[i].width=t,this.events[i].height=e;this.isHTML&&(this.htmlElement.style.width=t+"px",this.htmlElement.style.height=e+"px")},e.prototype.setChildren=function(t){this.childrens.push(t)},e.prototype.getChildrens=function(){return this.childrens},e.prototype.getElements=function(){return this.renderElements},e.prototype.isVisible=function(){for(var t=!1,e=this.renderElements.length-1;e>=0;e--)if(t!=this.renderElements.visible)return!t;return t},e.prototype.setDepth=function(t){for(var e=0;e<this.getElements().length;e++)this.getElements()[e].setDepth(t+e)},e.prototype.setOpacity=function(t){for(var e=0;e<this.getElements().length;e++)this.getElements()[e].setOpacity(t);for(var i=this.getChildrens(),e=0;e<i.length;e++)i[e].setOpacity(t);this.isHTML&&(this.htmlElement.style.opacity=t)},e.prototype.setVisible=function(t){this.visible=t;for(var e=0;e<this.getElements().length;e++)this.getElements()[e].setVisible(t);for(var i=this.getChildrens(),e=0;e<i.length;e++)i[e].setVisible(t);this.isHTML&&(t?this.htmlElement.style.display="block":this.htmlElement.style.display="none")},e.prototype.click=function(t){this.functionsToCall.click.push(t)},e.prototype.out=function(t){this.functionsToCallWhenOut.click.push(t)},e.prototype.hover=function(t){this.functionsToCall.hover.push(t)},e.prototype.leave=function(t){this.functionsToCall.leave.push(t)},e}(Render.Draw.Draw);t.GUI=e}(UI||(UI={}));var UI;!function(t){var e=function(e){function i(i,n,o,s){e.call(this),this.guiType="window",this.setPosition(i,n),this.setSize(o,s);var r=this.getPosition(!1);this.renderElements[0]=new Render.Draw.Rectangle(r.x,r.y,o,s,"rgba(255,255,255,1)");for(var h=0;h<this.renderElements.length;++h)t.getUsedCanvas().set(this.renderElements[h])}return __extends(i,e),i}(t.GUI);t.Window=e}(UI||(UI={}));var UI;!function(t){var e=function(e){function i(i,n,o,s,r){for(var h=[],a=5;a<arguments.length;a++)h[a-5]=arguments[a];e.call(this),this.guiType="label",h[0]&&this.setParent(h[0]),this.setSize(o,s),this.setPosition(i,n),this.value=r;var l=this.getPosition(!1);this.renderElements[0]=new Render.Draw.Text(l.x,l.y,this.value,o,s),this.renderElements[0].setDepth(10),this.renderElements[0].setMultiline(!0);for(var u=0;u<this.renderElements.length;++u)t.getUsedCanvas().set(this.renderElements[u])}return __extends(i,e),i.prototype.setValue=function(t){this.value=t,this.renderElements[0].setValue(this.value)},i.prototype.getValue=function(){return this.value},i.prototype.setFontSize=function(t){for(var e=this.renderElements.length-1;e>=0;e--)this.renderElements[e].setFontSize(t)},i.prototype.setFontStyle=function(t){for(var e=this.renderElements.length-1;e>=0;e--)this.renderElements[e].setFontStyle(t)},i.prototype.setFont=function(t){for(var e=this.renderElements.length-1;e>=0;e--)this.renderElements[e].setFont(t)},i.prototype.setBaseline=function(t){for(var e=this.renderElements.length-1;e>=0;e--)this.renderElements[e].setBaseline(t)},i.prototype.setAlign=function(t){for(var e=this.renderElements.length-1;e>=0;e--)this.renderElements[e].setAlign(t)},i}(t.GUI);t.Label=e}(UI||(UI={}));var UI;!function(t){var e=function(e){function i(i,n,o,s){for(var r=[],h=4;h<arguments.length;h++)r[h-4]=arguments[h];e.call(this),this.guiType="button",r[0]&&this.setParent(r[0]),this.setPosition(i,n),this.setSize(o,s),this.value="";var a=this.getPosition(!1);this.renderElements[0]=new Render.Draw.Rectangle(a.x,a.y,o,s,"rgba(255,255,255,1)"),this.renderElements[0].setShadow(!0),this.renderElements[0].setShadowColor("rgba(0,0,0,0.3)"),this.renderElements[0].setShadowBlur(10),this.renderElements[0].setDepth(1),this.renderElements[1]=new Render.Draw.Text(a.x,a.y,this.value,o,s),this.renderElements[1].setAlign("center"),this.renderElements[1].setVerticalAlign("middle"),this.renderElements[1].setFontStyle("bold"),this.renderElements[1].setDepth(2);for(var l=0;l<this.renderElements.length;++l)t.getUsedCanvas().set(this.renderElements[l])}return __extends(i,e),i.prototype.setValue=function(t){this.value,this.renderElements[1].setValue(t)},i.prototype.getValue=function(){return this.value},i.prototype.setBackgroundColor=function(t){this.renderElements[0].setColor(t)},i}(t.GUI);t.Button=e}(UI||(UI={}));var UI;!function(t){var e=document.createElement("div");e.style.zIndex="100",e.style.position="absolute",document.body.appendChild(e);var i=function(t){function i(i,n,o,s){for(var r=[],h=4;h<arguments.length;h++)r[h-4]=arguments[h];t.call(this),this.guiType="field",this.isHTML=!0,this.htmlElement=document.createElement("input"),e.appendChild(this.htmlElement),r[0]&&this.setParent(r[0]),this.setPosition(i,n),this.setSize(o,s),this.setValue(""),this.setPlaceholder("")}return __extends(i,t),i.prototype.isFocused=function(t){return 1!=t&&0!=t?this.focus:void(this.focus=t)},i.prototype.setValue=function(t){this.value=t,this.isHTML&&(this.htmlElement.value=t)},i.prototype.getValue=function(){if(this.isHTML){var t=this.htmlElement.value;t!=this.value&&this.setValue(t)}return this.value},i.prototype.setPlaceholder=function(t){this.placeholder=t,this.isHTML&&(this.htmlElement.placeholder=t)},i}(t.GUI);t.Field=i}(UI||(UI={}));var UI;!function(t){var e=function(e){function i(i,n,o,s){for(var r=this,h=[],a=4;a<arguments.length;a++)h[a-4]=arguments[a];e.call(this),this.guiType="checkbox",h[0]&&this.setParent(h[0]),this.setPosition(i,n),this.setSize(o,s),this.checked=!1,this.functionsToCallWhenCheck=[];var l=this.getPosition(!1);this.renderElements[0]=new Render.Draw.Rectangle(l.x,l.y,o,s,"rgba(0,0,0,0.1)"),this.renderElements[0].setDepth(10);for(var u=0;u<this.renderElements.length;++u)t.getUsedCanvas().set(this.renderElements[u]);this.click(function(){r.isChecked()?r.setCheck(!1):r.setCheck(!0);for(var t=r.functionsToCallWhenCheck.length-1;t>=0;t--)r.functionsToCallWhenCheck[t](r.isChecked())})}return __extends(i,e),i.prototype.isChecked=function(){return this.checked},i.prototype.setCheck=function(t){this.checked=t},i.prototype.check=function(t){this.functionsToCallWhenCheck.push(t)},i}(t.GUI);t.Checkbox=e}(UI||(UI={}));var Sounds;!function(t){function e(t){n=t}function i(){for(var t=[],e=0;e<o.length;++e)o[e].playing&&t.push(o[e]);return t}var n=!0,o=[];t.setEnabled=e,t.getPlayingSounds=i;var s=function(t){function e(e){t.call(this),this.element=null,this.isReady=!1,this.playing=!1;var i=this;Global.isAndroid()?"undefined"!=typeof window.Media&&(this.element=new window.Media("/android_asset/www/"+e,function(){i.emit("end")},function(t){console.log("Error",t)}),setTimeout(function(){i.isReady=!0,i.emit("ready")},100)):"undefined"!=typeof Audio&&(this.element=new Audio(e),this.element.addEventListener("canplaythrough",function(){i.isReady=!0,i.emit("ready")}),this.element.addEventListener("ended",function(){i.emit("end")})),this.path=e,this.duration=0,this.volume=1,this.element&&(this.duration=this.element.duration,this.volume=this.element.volume),this.currentTime=0,this.muted=!1,this.muteTemp=1,o.push(this)}return __extends(e,t),e.prototype.getPath=function(){return this.path},e.prototype.setPath=function(t){this.path=t,this.element.src=t},e.prototype.getDuration=function(){return this.duration},e.prototype.getVolume=function(){return this.volume},e.prototype.setVolume=function(t){t>=0&&(this.volume=t,"undefined"!=typeof window.Media?this.element.setVolume(t):this.element.volume=t,this.emit("volumechange"))},e.prototype.setCurrentTime=function(t){this.currentTime=t,"undefined"!=typeof window.Media?this.element.seekTo(t):this.element.currentTime=t},e.prototype.getCurrentTime=function(){return this.currentTime},e.prototype.isMute=function(){return this.muted},e.prototype.play=function(){this.element&&(n&&(this.element.play(),this.playing=!0),this.emit("play"))},e.prototype.pause=function(){this.element.pause(),this.playing=!1,this.emit("pause")},e.prototype.stop=function(){this.pause(),this.setCurrentTime(0),Global.isAndroid()&&this.element.stop(),this.playing=!0,this.emit("stop")},e.prototype.mute=function(){this.muteTemp=this.getVolume(),this.setVolume(0),this.muted=!0,this.emit("mute")},e.prototype.isPlaying=function(){return this.playing},e.prototype.unmute=function(){this.muteTemp&&this.setVolume(this.muteTemp),this.muted=!1,this.emit("unmute")},e}(Events);t.Sound=s}(Sounds||(Sounds={}));var Maps;!function(t){var e="./maps/",i=function(t){function i(i){var n=this;t.call(this),this.request=new Global.XHR(e+i+"/map.json"),this.request.ready(function(t){if(4==t.readyState){var e=JSON.parse(t.response);e&&n.emit("ready",e)}})}return __extends(i,t),i}(Events);t.Download=i;var n=function(t){function e(e,i,n,o,s,r){t.call(this,0),this.setFixedRotation(!0);var h;if("triangle"==s&&r){var a,l=i.getTileSize()/2;a="left"==r?[[-l,l],[l,-l],[l,l]]:[[-l,l],[-l,-l],[l,l]],h=new p2.Convex({vertices:a})}else h=new p2.Box({width:i.getTileSize(),height:i.getTileSize()});this.addShape(h),this.setType("tile"),this.canCollideWith("player","bullet"),this.setPosition(n,o),e.addBody(this)}return __extends(e,t),e}(Elements);t.Tile=n;var o=function(e){function i(i,n,o){var s=this;e.call(this),this.mapSpawns=[],this.mapPickups=[],this.grid=n,this.world=o,this.size={width:0,height:0},this.mapProperties=[],this.textures=[],this.mapName=i,this.mapLayers=[];var r=[],h=new t.Download(i);h.on("ready",function(t){s.mapVersion=t.version,s.mapType=t.type,s.size={width:t.width,height:t.height};for(var e=t.layers.length-1;e>=0;e--){for(var i=[],n=t.layers[e].data,o=n.length,h=0;h<s.size.width;++h){i[h]=[];for(var a=0;a<s.size.height;++a)i[h][a]=[]}for(var l=0,u=0,c=0;c<o;++c)u<s.size.width&&(i[u][l]=n[c],u++),u==s.size.width&&(l++,u=0);s.mapLayers.push(i)}for(var p=t.tilesets[0].tileproperties,d=0;d<Object.keys(p).length;++d)s.mapProperties[d]=p[d];for(var h=t.tilesets.length-1;h>=0;h--)if(t.tilesets[h]){var f;t.tilesets[h].image;f={},f.src="assets/tileset.png",f.name="tileset",Render.add(f.src),r.push(f)}for(var g=r.length-1;g>=0;g--)s.textures[r[g].name]=new Render.Texture(r[g].src);for(var e=s.mapLayers.length-1;e>=0;e--){var i;i=s.mapLayers[e];for(var h=i.length-1;h>=0;h--)for(var a=i[h].length-1;a>=0;a--){var y=i[h][a];if(0!=y){var v=new Grid.Tile(s.grid,h,a),m=s.getProperties()[y-1],w=new Render.Sprite(s.textures.tileset,0,0,s.grid.getTileSize(),s.grid.getTileSize(),256,256,27);w.setFreeze(!0),w.setDepth(-1),w.setFrameLine(m.line),w.setCurrentFrame(m.frame-1),v.assignDrawable(w)}}}s.emit("ready")})}return __extends(i,e),i.prototype.getName=function(){return this.mapName},i.prototype.getType=function(){return this.mapType},i.prototype.getVersion=function(){return this.mapVersion},i.prototype.getSpawns=function(){return this.mapSpawns},i.prototype.getPickups=function(){return this.mapPickups},i.prototype.getSize=function(){return this.size},i.prototype.getProperties=function(){return this.mapProperties},i}(Events);t.Load=o}(Maps||(Maps={}));var Particles;!function(t){var e=[],i=function(){function t(t,i){this.name=t,this.texture=i,e.push(this)}return t.prototype.getName=function(){return this.name},t.prototype.getTexture=function(){return this.texture},t}();t.ParticleType=i;var n=function(t){function i(i,n,o){t.call(this),this.setPosition(i-64,n-64),this.setMass(0);for(var s=e.length-1;s>=0;s--)if(e[s].getName()==o){var r=new Render.Sprite(e[s].getTexture(),i-64,n-64,128,128,256,256,5,0);r.setUniqueLoop(!0),this.assignDrawable(r),particlesCanvas.set(r)}}return __extends(i,t),i.prototype.play=function(){this.getAssignedDrawable()&&this.getAssignedDrawable().playUniqueLoop()},i}(Elements);t.Particle=n}(Particles||(Particles={}));